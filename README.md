# 🎨 HSE ML Contrast Checker

[![Python 3.10+](https://img.shields.io/badge/python-3.10+-blue.svg)](https://www.python.org/downloads/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Code style: black](https://img.shields.io/badge/code%20style-black-000000.svg)](https://github.com/psf/black)
[![Docker Image](https://img.shields.io/docker/v/danilzebzeev/hse-contrast-checker?label=docker&logo=docker)](https://hub.docker.com/r/danilzebzeev/hse-contrast-checker)

Production-ready Python инструмент для анализа контрастности текста и фона согласно стандарту **WCAG 2.2** с использованием **машинного обучения**.

> 🆕 **Новое в версии 1.1:**
> - 🌐 Современный FastAPI веб-интерфейс с интуитивным UI
> - 🔍 Автоматическое извлечение слайдов из HTML презентаций (Selenium поддержка)
> - 📦 Batch анализ всей презентации одной командой
> - 🎯 Выбор режима: анализ одного слайда или всей презентации
> - 📊 Улучшенные HTML отчёты с детальной статистикой
> - 🧪 Расширенное тестовое покрытие

## 📋 Обзор

Этот инструмент анализирует контрастность между текстом и фоном в презентационных слайдах, используя ML алгоритмы для извлечения доминирующих цветов и расчета соответствия WCAG.

### ✨ Ключевые возможности

- ✅ **Соответствие WCAG 2.2**: Точный расчет контрастности по стандарту WCAG
- 🤖 **ML-алгоритмы**: Два алгоритма обучения без учителя для извлечения цветов:
  - **Median-cut** (быстрее, Pillow ADAPTIVE)
  - **K-means кластеризация** (точнее, scikit-learn)
- 🌐 **Современный веб-интерфейс**: FastAPI веб-приложение с интуитивным UI
  - Анализ по URL (с поддержкой Selenium для динамических сайтов)
  - Загрузка HTML файлов презентаций
  - Выбор режима: один слайд или вся презентация
  - Автоматическое извлечение и анализ всех слайдов
- 📦 **Batch обработка**: Анализ множества слайдов одной командой
- 🔍 **Продвинутый scraper**: 
  - Базовый scraper для статических HTML
  - Продвинутый scraper с Selenium для JavaScript-презентаций
  - Поддержка извлечения отдельных слайдов по индексу
  - Автоматическое извлечение всех слайдов из презентации
- 📊 **HTML отчеты**: Визуальные отчеты с рекомендациями и примерами цветов
- 🐳 **Docker готов**: Включен multi-stage Docker build
- 🧪 **Хорошо протестирован**: Комплексный набор тестов с pytest
- 📝 **Типобезопасен**: Полные type hints и проверка mypy
- 🎯 **CLI интерфейс**: Удобный инструмент командной строки

## 🚀 Быстрый старт

Всего **3 простых шага** для запуска веб-приложения:

```bash
# 1. Скачайте репозиторий
git clone https://github.com/DaniilZebzeev/hse-ml-contrast-checker.git
cd hse-ml-contrast-checker

# 2. Запустите Docker Compose
docker-compose up --build

# 3. Откройте в браузере
# http://localhost:8000
```

**Готово!** 🎉 Веб-интерфейс запущен и готов к использованию.

### Что делает веб-приложение?

- 📥 **Анализ по URL**: Просто вставьте ссылку на презентацию Diaclass
- 📁 **Загрузка файлов**: Перетащите HTML файл презентации
- 🎯 **Гибкий анализ**: 
  - Проанализируйте один конкретный слайд
  - Или всю презентацию целиком одним кликом
- 🤖 **Выбор ML метода**: 
  - **Median Cut** - быстрее, отлично для простых фонов
  - **K-means** - точнее, для сложных изображений
- 📊 **Красивые отчёты**: 
  - Интерактивные HTML отчёты с визуализацией
  - JSON файлы для программной обработки
  - Детальная статистика по каждому слайду

## 📚 Как это работает

### 1. Загрузка слайдов

Веб-приложение поддерживает два способа загрузки:

**Через URL:**
```
https://app.diaclass.ru/share/xxxxx
```
Приложение автоматически извлечет все слайды используя Selenium

**Через файл:**
Просто перетащите HTML файл с презентацией в окно браузера

### 2. ML извлечение цветов

Приложение использует машинное обучение для анализа фоновых изображений:

**Median-cut алгоритм** (рекомендуется для быстрого анализа):
- ⚡ Быстрая квантизация палитры
- 🎯 Рекурсивное деление цветового пространства
- 📊 Отлично работает с простыми фонами

**K-means кластеризация** (для максимальной точности):
- 🎨 Более точный для сложных изображений
- 🤖 Подход обучения без учителя
- 🔬 Находит истинные доминирующие цвета

### 3. Расчет контрастности WCAG 2.2

Формула: `(L1 + 0.05) / (L2 + 0.05)`

| Уровень | Обычный текст | Крупный текст |
|---------|---------------|---------------|
| AA      | 4.5:1         | 3:1           |
| AAA     | 7:1           | 4.5:1         |

**Крупный текст** = 18pt+ (24px+) ИЛИ 14pt+ жирный (18.67px+ жирный)

### 4. Результаты анализа

После анализа вы получите:

- 📊 **Интерактивную статистику** прямо в браузере
- 🎨 **HTML отчёты** с визуализацией цветовых комбинаций
- 📄 **JSON файлы** для программной обработки
- ✅ **Рекомендации** по улучшению контрастности

Все результаты автоматически сохраняются в папке `web_output/` и доступны для скачивания.

## 🎯 Использование веб-интерфейса

### Шаг 1: Выберите источник

Перейдите на одну из вкладок:
- **"Загрузить по URL"** - для онлайн-презентаций Diaclass
- **"Загрузить HTML файл"** - для локальных файлов

### Шаг 2: Настройте параметры

- **ML метод**: Выберите Median Cut (быстрее) или K-means (точнее)
- **Режим анализа**:
  - **Один слайд** - укажите номер слайда
  - **Вся презентация** - проанализирует все слайды автоматически

### Шаг 3: Запустите анализ

Нажмите кнопку **"Анализировать"** и подождите несколько секунд.

### Шаг 4: Изучите результаты

Вы увидите:
- 📈 Общую статистику по всем слайдам
- 📊 Детальные данные для каждого слайда
- 🔗 Ссылки на HTML отчёты и JSON файлы
- ✅ Количество прошедших/непрошедших WCAG проверку элементов

## 🏗️ Архитектура

```
┌──────────────────────────────────────┐
│       Веб-браузер (Ваш браузер)      │
│         http://localhost:8000         │
└────────────────┬─────────────────────┘
                 │
                 │ HTTP/REST API
                 │
┌────────────────▼─────────────────────┐
│     FastAPI Веб-приложение           │
│  • Обработка URL и файлов            │
│  • Selenium для извлечения слайдов   │
│  • Управление сессиями               │
└────────────────┬─────────────────────┘
                 │
┌────────────────▼─────────────────────┐
│     Анализатор контрастности         │
│  • ML извлечение цветов              │
│  • Расчёт контрастности WCAG         │
│  • Генерация отчётов                 │
└──────────────────────────────────────┘
```

Подробнее см. [docs/ARCHITECTURE.md](docs/ARCHITECTURE.md).

## 🧪 Тестирование

Проект имеет комплексное тестовое покрытие:

```bash
# Запустить все тесты
docker-compose run --rm contrast-checker pytest tests/ -v

# С покрытием кода
docker-compose run --rm contrast-checker pytest tests/ --cov=src --cov-report=html
```

См. [TESTING_REPORT.md](TESTING_REPORT.md) для подробного отчёта о тестировании.

## 📖 Документация API

См. [docs/API.md](docs/API.md) для подробной справки API.

## 🤖 ML подход

Этот проект использует **обучение без учителя** для извлечения цветов:

### Median-cut алгоритм
- **Тип**: Рекурсивная квантизация палитры
- **Сложность**: O(n log k)
- **Плюсы**: Быстрый, детерминированный
- **Минусы**: Менее точен для сложных градиентов

### K-means кластеризация
- **Тип**: Итеративная оптимизация кластеров
- **Сложность**: O(n * k * i), где i = итерации
- **Плюсы**: Более точный, находит "истинные" доминирующие цвета
- **Минусы**: Медленнее, требует больше памяти

См. [docs/ML_APPROACH.md](docs/ML_APPROACH.md) для математических деталей.

## 🔧 Конфигурация

### Docker Compose

Файл `docker-compose.yml` уже настроен и готов к использованию. По умолчанию:

- **Порт**: 8000 (можно изменить в `docker-compose.yml`)
- **Результаты**: Сохраняются в `web_output/`
- **Логи**: Выводятся в консоль

### Переменные окружения

Вы можете настроить приложение через переменные окружения:

```yaml
environment:
  - ML_METHOD=mediancut  # или kmeans
  - DEFAULT_K_COLORS=5
  - SELENIUM_WAIT_TIME=5
```

### API Endpoints

Веб-приложение предоставляет REST API:

- `GET /` - Главная страница веб-интерфейса
- `GET /health` - Проверка состояния сервиса
- `POST /api/analyze-url` - Анализ по URL
- `POST /api/analyze-file` - Анализ загруженного файла
- `GET /api/result/{session_id}/{filename}` - Получение результатов

Подробнее см. [docs/API.md](docs/API.md).

## 📊 Пример использования

### Пример 1: Анализ презентации по URL

1. Откройте http://localhost:8000
2. Перейдите на вкладку **"Загрузить по URL"**
3. Вставьте ссылку: `https://app.diaclass.ru/share/xxxxx`
4. Выберите **"Вся презентация"**
5. Нажмите **"Анализировать"**

**Результат:**
```
✅ Проанализировано слайдов: 10
📊 Всего текстовых элементов: 45
✅ Прошли WCAG AA: 38 (84%)
❌ Не прошли WCAG AA: 7 (16%)
```

### Пример 2: Анализ одного слайда из файла

1. Откройте http://localhost:8000
2. Перейдите на вкладку **"Загрузить HTML файл"**
3. Перетащите файл `presentation.html`
4. Выберите **"Один слайд"**, укажите номер **5**
5. Выберите метод **K-means** для более точного анализа
6. Нажмите **"Анализировать"**

**Результат:**
```
Слайд 5
✅ Всего элементов: 3
✅ Прошли WCAG AA Normal: 2
❌ Не прошли WCAG AA Normal: 1

Доступны:
🔗 HTML отчёт с визуализацией
📄 JSON файл с детальными данными
```

## 🛠️ Технологии

### Backend
- **FastAPI** - Современный веб-фреймворк
- **Python 3.10+** - Основной язык программирования
- **Selenium** - Автоматизация браузера для извлечения слайдов
- **BeautifulSoup** - Парсинг HTML

### Machine Learning
- **scikit-learn** - K-means кластеризация
- **Pillow** - Median-cut алгоритм и обработка изображений
- **NumPy** - Матричные вычисления

### Frontend
- **Vanilla JavaScript** - Интерактивный UI
- **CSS3** - Современный дизайн
- **HTML5** - Семантическая разметка

### DevOps
- **Docker** - Контейнеризация
- **Docker Compose** - Оркестрация
- **pytest** - Тестирование

### Структура проекта

```
hse-ml-contrast-checker-main/
├── src/
│   ├── cli.py                        # CLI-интерфейс
│   ├── batch_analyzer.py             # Batch обработка слайдов
│   ├── webapp.py                     # FastAPI веб-приложение
│   ├── slide_scraper.py              # Базовый scraper для статических HTML
│   ├── slide_scraper_advanced.py     # Продвинутый scraper с Selenium
│   ├── color_parser.py               # Парсинг CSS-цветов (hex, rgb, hsl, named)
│   ├── color_parser_constants.py     # Константы цветов CSS
│   ├── contrast_checker.py           # Главный оркестратор анализа
│   ├── html_parser.py                # Извлечение элементов с BeautifulSoup
│   ├── image_analyzer.py             # ML-алгоритмы извлечения цветов
│   ├── report_generator.py           # Генерация HTML-отчётов
│   ├── wcag.py                       # Расчёты по стандарту WCAG 2.2
│   └── wcag_constants.py             # WCAG константы и пороги
├── templates/                        # HTML шаблоны для веб-интерфейса
│   └── index.html                    # Главная страница веб-приложения
├── static/                           # Статические файлы (CSS, JS)
│   ├── styles.css                    # Стили для веб-интерфейса
│   └── app.js                        # JavaScript логика
├── tests/                            # pytest тесты
│   ├── conftest.py                   # Общие фикстуры
│   ├── test_color_parser.py          # Тесты парсинга цветов
│   ├── test_html_parser.py           # Тесты HTML парсинга
│   ├── test_image_analyzer.py        # Тесты ML алгоритмов
│   ├── test_slide_scraper.py         # Тесты scraper модулей
│   ├── test_webapp.py                # Тесты FastAPI endpoints
│   └── README.md                     # Документация по тестам
├── examples/                         # Примеры JSON и HTML файлов
│   ├── demo_slide.json               # Простой пример слайда
│   ├── slide_color_bg.json           # Слайд с цветным фоном
│   ├── slide_with_image.json         # Слайд с фоновым изображением
│   ├── slide_complex.json            # Сложный слайд
│   └── diagclass.html                # Пример HTML презентации
├── docs/                             # Документация
│   ├── API.md                        # API справка
│   ├── ARCHITECTURE.md               # Описание архитектуры
│   └── ML_APPROACH.md                # ML подход и алгоритмы
├── web_output/                       # Результаты веб-анализа
├── output/                           # Результаты CLI анализа
├── Dockerfile                        # Multi-stage Docker build
├── docker-compose.yml                # Конфигурация Docker Compose
├── pytest.ini                        # Конфигурация pytest
├── requirements.txt                  # Production зависимости
├── requirements-dev.txt              # Development зависимости
├── TESTING_REPORT.md                 # Отчёт о тестировании
└── WEB_APP_README.md                 # Документация веб-приложения
```

### Стиль кода

- **Форматирование**: Black (длина строки 120)
- **Линтинг**: flake8
- **Проверка типов**: mypy
- **Docstrings**: Google style

## 🤝 Вклад в проект

1. Форкните репозиторий
2. Создайте feature ветку (`git checkout -b feature/amazing-feature`)
3. Закоммитьте изменения (`git commit -m 'feat: add amazing feature'`)
4. Запушьте в ветку (`git push origin feature/amazing-feature`)
5. Откройте Pull Request

## 📄 Лицензия

Этот проект лицензирован под лицензией MIT - см. файл [LICENSE](LICENSE) для деталей.

## 👥 Авторы

- https://github.com/JuliaPonomareva
- https://github.com/VKristin
- https://github.com/DaniilZebzeev

## 🙏 Благодарности

- [WCAG 2.2 Guidelines](https://www.w3.org/WAI/WCAG22/quickref/) за стандарты доступности
- [scikit-learn](https://scikit-learn.org/) за реализацию K-means
- [Pillow](https://pillow.readthedocs.io/) за обработку изображений
- [BeautifulSoup](https://www.crummy.com/software/BeautifulSoup/) за парсинг HTML
- [FastAPI](https://fastapi.tiangolo.com/) за современный веб-фреймворк
- [Selenium](https://www.selenium.dev/) за автоматизацию браузера
- [Click](https://click.palletsprojects.com/) за CLI интерфейс

## 📚 Дополнительная документация

- 📘 [WEB_APP_README.md](WEB_APP_README.md) - Подробная документация веб-приложения
- 📗 [TESTING_REPORT.md](TESTING_REPORT.md) - Отчёт о тестировании
- 📙 [tests/README.md](tests/README.md) - Руководство по запуску тестов
- 📕 [docs/API.md](docs/API.md) - API справка
- 📔 [docs/ARCHITECTURE.md](docs/ARCHITECTURE.md) - Описание архитектуры
- 📓 [docs/ML_APPROACH.md](docs/ML_APPROACH.md) - Детали ML алгоритмов

---

**Создано для курса "Прикладные аспекты машинного обучения" ВШЭ**
